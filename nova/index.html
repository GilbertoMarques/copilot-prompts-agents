<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Nova - Especialista em Carreira</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Nova - Especialista em Carreira</h1>
    <p class="description">Este agente cria um plano de estudos personalizado com base na carreira escolhida.</p>

    <!-- Widget de chat integrado (substituído por interface JS) -->
    <div class="chat-card" id="chat-card">
      <div id="chat-messages" class="chat-messages"></div>
      <form id="chat-form" class="chat-form">
        <input type="text" id="chat-input" autocomplete="off" placeholder="Digite sua pergunta..." />
        <button type="submit">Enviar</button>
      </form>
    </div>

    <!-- bust cache by adding version parameter, using relative path to parent -->
    <script src="../chat.js?v=1.0.4"></script>
    <script>
      // add persistent PDF button if there is saved plan
      document.addEventListener('DOMContentLoaded', ()=>{
        const stored = localStorage.getItem('lastPlan');
        if(stored){
          try{
            const plan = JSON.parse(stored);
            const btn = document.createElement('button');
            btn.textContent = 'Gerar PDF do último plano';
            btn.className='plan-actions';
            btn.style.marginTop='12px';
            btn.onclick = ()=>{
              const win = window.open('','_blank');
              const style = `body{font-family:Arial,sans-serif;padding:20px;color:#e6eef8;background:#0f1724;} .plan{white-space:pre-wrap;} .result-card{background:#334155;padding:10px 14px;border-radius:10px;margin:8px 0;}`;
              win.document.write('<html><head><title>Plano</title><style>'+style+'</style></head><body><h1>'+plan.career+'</h1><div class="plan">'+plan.html+'</div></body></html>');
              win.document.close();
              win.print();
            };
            document.querySelector('.container').appendChild(btn);
          }catch(e){console.error(e);}
        }
      });
    </script>
    <script src="../config.js" onerror="console.warn('config.js não encontrado; crie com sua chave.');"></script>

    <!-- modal for transfer info -->
    <div id="info-modal" class="modal hidden">
      <div class="modal-content">
        <span id="modal-close" class="modal-close">&times;</span>
        <div id="modal-body"></div>
      </div>
    </div>

    <script>
      // exibir dados recebidos da fase anterior (Atlas) em modal
      (function(){
        const params = new URLSearchParams(window.location.search);
        if(params.has('career')){
          const career = params.get('career');
          const hours = params.get('hours');
          const exp = params.get('experience');
          const obj = params.get('objective');
          const pref = params.get('preference');
          const inter = params.get('interests');
          const body = document.getElementById('modal-body');
          body.innerHTML = `<h2>Informações recebidas</h2>
<ul>
<li><strong>Carreira:</strong> ${career}</li>
<li><strong>Horas/sem:</strong> ${hours}</li>
<li><strong>Experiência:</strong> ${exp}</li>
<li><strong>Objetivo:</strong> ${obj}</li>
<li><strong>Preferência:</strong> ${pref}</li>
<li><strong>Interesses:</strong> ${inter}</li>
</ul>`;
          const modal = document.getElementById('info-modal');
          modal.classList.remove('hidden');
          modal.classList.add('show');
          document.getElementById('modal-close').onclick = ()=> { modal.classList.remove('show'); setTimeout(()=>modal.classList.add('hidden'),300); }
        }
      })();
    </script>
  </div>
</body>
</html>